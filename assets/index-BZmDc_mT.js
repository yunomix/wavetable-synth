var Dt=Object.defineProperty;var Lt=(e,t,n)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>Lt(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();var A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}),n}var Mt={},K={};function Ht(e){var t=new T(e),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var i=Vt(n.data),a=[],s=0;!t.eof()&&s<i.numTracks;s++){var r=t.readChunk();if(r.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+r.id+"'";var u=Wt(r.data);a.push(u)}return{header:i,tracks:a}}function Vt(e){var t=new T(e),n=t.readUInt16(),i=t.readUInt16(),a={format:n,numTracks:i},s=t.readUInt16();return s&32768?(a.framesPerSecond=256-(s>>8),a.ticksPerFrame=s&255):a.ticksPerBeat=s,a}function Wt(e){for(var t=new T(e),n=[];!t.eof();){var i=s();n.push(i)}return n;var a;function s(){var r={};r.deltaTime=t.readVarInt();var u=t.readUInt8();if((u&240)===240)if(u===255){r.meta=!0;var l=t.readUInt8(),o=t.readVarInt();switch(l){case 0:if(r.type="sequenceNumber",o!==2)throw"Expected length for sequenceNumber event is 2, got "+o;return r.number=t.readUInt16(),r;case 1:return r.type="text",r.text=t.readString(o),r;case 2:return r.type="copyrightNotice",r.text=t.readString(o),r;case 3:return r.type="trackName",r.text=t.readString(o),r;case 4:return r.type="instrumentName",r.text=t.readString(o),r;case 5:return r.type="lyrics",r.text=t.readString(o),r;case 6:return r.type="marker",r.text=t.readString(o),r;case 7:return r.type="cuePoint",r.text=t.readString(o),r;case 32:if(r.type="channelPrefix",o!=1)throw"Expected length for channelPrefix event is 1, got "+o;return r.channel=t.readUInt8(),r;case 33:if(r.type="portPrefix",o!=1)throw"Expected length for portPrefix event is 1, got "+o;return r.port=t.readUInt8(),r;case 47:if(r.type="endOfTrack",o!=0)throw"Expected length for endOfTrack event is 0, got "+o;return r;case 81:if(r.type="setTempo",o!=3)throw"Expected length for setTempo event is 3, got "+o;return r.microsecondsPerBeat=t.readUInt24(),r;case 84:if(r.type="smpteOffset",o!=5)throw"Expected length for smpteOffset event is 5, got "+o;var f=t.readUInt8(),d={0:24,32:25,64:29,96:30};return r.frameRate=d[f&96],r.hour=f&31,r.min=t.readUInt8(),r.sec=t.readUInt8(),r.frame=t.readUInt8(),r.subFrame=t.readUInt8(),r;case 88:if(r.type="timeSignature",o!=2&&o!=4)throw"Expected length for timeSignature event is 4 or 2, got "+o;return r.numerator=t.readUInt8(),r.denominator=1<<t.readUInt8(),o===4?(r.metronome=t.readUInt8(),r.thirtyseconds=t.readUInt8()):(r.metronome=36,r.thirtyseconds=8),r;case 89:if(r.type="keySignature",o!=2)throw"Expected length for keySignature event is 2, got "+o;return r.key=t.readInt8(),r.scale=t.readUInt8(),r;case 127:return r.type="sequencerSpecific",r.data=t.readBytes(o),r;default:return r.type="unknownMeta",r.data=t.readBytes(o),r.metatypeByte=l,r}}else if(u==240){r.type="sysEx";var o=t.readVarInt();return r.data=t.readBytes(o),r}else if(u==247){r.type="endSysEx";var o=t.readVarInt();return r.data=t.readBytes(o),r}else throw"Unrecognised MIDI event type byte: "+u;else{var c;if(u&128)c=t.readUInt8(),a=u;else{if(a===null)throw"Running status byte encountered before status byte";c=u,u=a,r.running=!0}var h=u>>4;switch(r.channel=u&15,h){case 8:return r.type="noteOff",r.noteNumber=c,r.velocity=t.readUInt8(),r;case 9:var p=t.readUInt8();return r.type=p===0?"noteOff":"noteOn",r.noteNumber=c,r.velocity=p,p===0&&(r.byte9=!0),r;case 10:return r.type="noteAftertouch",r.noteNumber=c,r.amount=t.readUInt8(),r;case 11:return r.type="controller",r.controllerType=c,r.value=t.readUInt8(),r;case 12:return r.type="programChange",r.programNumber=c,r;case 13:return r.type="channelAftertouch",r.amount=c,r;case 14:return r.type="pitchBend",r.value=c+(t.readUInt8()<<7)-8192,r;default:throw"Unrecognised MIDI event type: "+h}}}}function T(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}T.prototype.eof=function(){return this.pos>=this.bufferLen};T.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};T.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};T.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};T.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};T.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(e<<16)+(t<<8)+n};T.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};T.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),i=this.readUInt8();return(e<<24)+(t<<16)+(n<<8)+i};T.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};T.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};T.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};T.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:e,length:t,data:n}};var zt=Ht;function qt(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var n=e.header||{},i=e.tracks||[],a,s=i.length,r=new b;for(Jt(r,n,s),a=0;a<s;a++)Gt(r,i[a],t);return r.buffer}function Jt(e,t,n){var i=t.format==null?1:t.format,a=128;t.timeDivision?a=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?a=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(a=t.ticksPerBeat&32767);var s=new b;s.writeUInt16(i),s.writeUInt16(n),s.writeUInt16(a),e.writeChunk("MThd",s.buffer)}function Gt(e,t,n){var i=new b,a,s=t.length,r=null;for(a=0;a<s;a++)(n.running===!1||!n.running&&!t[a].running)&&(r=null),r=Yt(i,t[a],r,n.useByte9ForNoteOff);e.writeChunk("MTrk",i.buffer)}function Yt(e,t,n,i){var a=t.type,s=t.deltaTime,r=t.text||"",u=t.data||[],l=null;switch(e.writeVarInt(s),a){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(r.length),e.writeString(r);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(r.length),e.writeString(r);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(r.length),e.writeString(r);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(r.length),e.writeString(r);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(r.length),e.writeString(r);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(r.length),e.writeString(r);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(r.length),e.writeString(r);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var o={24:0,25:32,29:64,30:96},f=t.hour&31|o[t.frameRate];e.writeUInt8(f),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var d=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(d),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(u.length),e.writeBytes(u);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(u.length),e.writeBytes(u));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(u.length),e.writeBytes(u);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(u.length),e.writeBytes(u);break;case"noteOff":var c=i!==!1&&t.byte9||i&&t.velocity==0?144:128;l=c|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":l=144|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":l=160|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":l=176|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":l=192|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":l=208|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":l=224|t.channel,l!==n&&e.writeUInt8(l);var h=8192+t.value,p=h&127,y=h>>7&127;e.writeUInt8(p),e.writeUInt8(y);break;default:throw"Unrecognized event type: "+a}return l}function b(){this.buffer=[]}b.prototype.writeUInt8=function(e){this.buffer.push(e&255)};b.prototype.writeInt8=b.prototype.writeUInt8;b.prototype.writeUInt16=function(e){var t=e>>8&255,n=e&255;this.writeUInt8(t),this.writeUInt8(n)};b.prototype.writeInt16=b.prototype.writeUInt16;b.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(i)};b.prototype.writeInt24=b.prototype.writeUInt24;b.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,i=e>>8&255,a=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(i),this.writeUInt8(a)};b.prototype.writeInt32=b.prototype.writeUInt32;b.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};b.prototype.writeString=function(e){var t,n=e.length,i=[];for(t=0;t<n;t++)i.push(e.codePointAt(t));this.writeBytes(i)};b.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(t&127),t>>=7;t;){var i=t&127|128;n.push(i),t>>=7}this.writeBytes(n.reverse())}};b.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var Xt=qt;K.parseMidi=zt;K.writeMidi=Xt;var Y={},N={};Object.defineProperty(N,"__esModule",{value:!0});N.insert=N.search=void 0;function Et(e,t,n){n===void 0&&(n="ticks");var i=0,a=e.length,s=a;if(a>0&&e[a-1][n]<=t)return a-1;for(;i<s;){var r=Math.floor(i+(s-i)/2),u=e[r],l=e[r+1];if(u[n]===t){for(var o=r;o<e.length;o++){var f=e[o];f[n]===t&&(r=o)}return r}else{if(u[n]<t&&l[n]>t)return r;u[n]>t?s=r:u[n]<t&&(i=r+1)}}return-1}N.search=Et;function Kt(e,t,n){if(n===void 0&&(n="ticks"),e.length){var i=Et(e,t[n],n);e.splice(i+1,0,t)}else e.push(t)}N.insert=Kt;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=N,n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function a(s){var r=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),s){n.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(l){l.forEach(function(o){o.meta&&(o.type==="timeSignature"?r.timeSignatures.push({ticks:o.absoluteTime,timeSignature:[o.numerator,o.denominator]}):o.type==="setTempo"?r.tempos.push({bpm:6e7/o.microsecondsPerBeat,ticks:o.absoluteTime}):o.type==="keySignature"&&r.keySignatures.push({key:e.keySignatureKeys[o.key+7],scale:o.scale===0?"major":"minor",ticks:o.absoluteTime}))})});var u=0;s.tracks[0].forEach(function(l){u+=l.deltaTime,l.meta&&(l.type==="trackName"?r.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&r.meta.push({text:l.text,ticks:u,type:l.type}))}),this.update()}}return a.prototype.update=function(){var s=this,r=0,u=0;this.tempos.sort(function(l,o){return l.ticks-o.ticks}),this.tempos.forEach(function(l,o){var f=o>0?s.tempos[o-1].bpm:s.tempos[0].bpm,d=l.ticks/s.ppq-u,c=60/f*d;l.time=c+r,r=l.time,u+=d}),this.timeSignatures.sort(function(l,o){return l.ticks-o.ticks}),this.timeSignatures.forEach(function(l,o){var f=o>0?s.timeSignatures[o-1]:s.timeSignatures[0],d=(l.ticks-f.ticks)/s.ppq,c=d/f.timeSignature[0]/(f.timeSignature[1]/4);f.measures=f.measures||0,l.measures=c+f.measures})},a.prototype.ticksToSeconds=function(s){var r=(0,t.search)(this.tempos,s);if(r!==-1){var u=this.tempos[r],l=u.time,o=(s-u.ticks)/this.ppq;return l+60/u.bpm*o}else{var f=s/this.ppq;return 60/120*f}},a.prototype.ticksToMeasures=function(s){var r=(0,t.search)(this.timeSignatures,s);if(r!==-1){var u=this.timeSignatures[r],l=(s-u.ticks)/this.ppq;return u.measures+l/(u.timeSignature[0]/u.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(a.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),a.prototype.secondsToTicks=function(s){var r=(0,t.search)(this.tempos,s,"time");if(r!==-1){var u=this.tempos[r],l=u.time,o=s-l,f=o/(60/u.bpm);return Math.round(u.ticks+f*this.ppq)}else{var d=s/.5;return Math.round(d*this.ppq)}},a.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},a.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(r){return Object.assign({},r)}),this.timeSignatures=s.timeSignatures.map(function(r){return Object.assign({},r)}),this.keySignatures=s.keySignatures.map(function(r){return Object.assign({},r)}),this.meta=s.meta.map(function(r){return Object.assign({},r)}),n.set(this,s.ppq),this.update()},a.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},a}();e.Header=i})(Y);var j={},dt={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(a,s){return a[e.controlChangeNames[s]]=s,a},{});var t=new WeakMap,n=new WeakMap,i=function(){function a(s,r){t.set(this,r),n.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(a.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var s=t.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var r=t.get(this);this.ticks=r.secondsToTicks(s)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},a}();e.ControlChange=i})(dt);var $={};Object.defineProperty($,"__esModule",{value:!0});$.createControlChanges=void 0;var q=dt;function $t(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if(q.controlChangeIds.hasOwnProperty(t))return e[q.controlChangeIds[t]]},set:function(e,t,n){return q.controlChangeIds.hasOwnProperty(t)?e[q.controlChangeIds[t]]=n:e[t]=n,!0}})}$.createControlChanges=$t;var Q={};Object.defineProperty(Q,"__esModule",{value:!0});Q.PitchBend=void 0;var ct=new WeakMap,Qt=function(){function e(t,n){ct.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=ct.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=ct.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();Q.PitchBend=Qt;var Z={},P={};Object.defineProperty(P,"__esModule",{value:!0});P.DrumKitByPatchID=P.InstrumentFamilyByID=P.instrumentByPatchID=void 0;P.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];P.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];P.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Z,"__esModule",{value:!0});Z.Instrument=void 0;var J=P,mt=new WeakMap,Zt=function(){function e(t,n){if(this.number=0,mt.set(this,n),this.number=0,t){var i=t.find(function(a){return a.type==="programChange"});i&&(this.number=i.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?J.DrumKitByPatchID[this.number]:J.instrumentByPatchID[this.number]},set:function(t){var n=J.instrumentByPatchID.indexOf(t);n!==-1&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":J.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=mt.get(this);return t.channel===9},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},e.prototype.fromJSON=function(t){this.number=t.number},e}();Z.Instrument=Zt;var tt={};Object.defineProperty(tt,"__esModule",{value:!0});tt.Note=void 0;function te(e){var t=Math.floor(e/12)-1;return Pt(e)+t.toString()}function Pt(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function ee(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var ne=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var i=e.exec(n),a=i[1],s=i[2],r=t[a.toLowerCase()];return r+(parseInt(s,10)+1)*12}}(),_=new WeakMap,re=function(){function e(t,n,i){_.set(this,i),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=n.velocity,this.ticks=t.ticks,this.durationTicks=n.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return te(this.midi)},set:function(t){this.midi=ne(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var n=t-this.octave;this.midi+=n*12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return Pt(this.midi)},set:function(t){this.midi=12*(this.octave+1)+ee(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=_.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var n=_.get(this),i=n.secondsToTicks(this.time+t);this.durationTicks=i-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=_.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=_.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=_.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();tt.Note=re;Object.defineProperty(j,"__esModule",{value:!0});j.Track=void 0;var lt=N,ie=dt,ae=$,se=Q,pt=Z,oe=tt,G=new WeakMap,ce=function(){function e(t,n){var i=this;if(this.name="",this.notes=[],this.controlChanges=(0,ae.createControlChanges)(),this.pitchBends=[],G.set(this,n),t){var a=t.find(function(c){return c.type==="trackName"});this.name=a?a.text:""}if(this.instrument=new pt.Instrument(t,this),this.channel=0,t){for(var s=t.filter(function(c){return c.type==="noteOn"}),r=t.filter(function(c){return c.type==="noteOff"}),u=function(){var c=s.shift();l.channel=c.channel;var h=r.findIndex(function(y){return y.noteNumber===c.noteNumber&&y.absoluteTime>=c.absoluteTime});if(h!==-1){var p=r.splice(h,1)[0];l.addNote({durationTicks:p.absoluteTime-c.absoluteTime,midi:c.noteNumber,noteOffVelocity:p.velocity/127,ticks:c.absoluteTime,velocity:c.velocity/127})}},l=this;s.length;)u();var o=t.filter(function(c){return c.type==="controller"});o.forEach(function(c){i.addCC({number:c.controllerType,ticks:c.absoluteTime,value:c.value/127})});var f=t.filter(function(c){return c.type==="pitchBend"});f.forEach(function(c){i.addPitchBend({ticks:c.absoluteTime,value:c.value/Math.pow(2,13)})});var d=t.find(function(c){return c.type==="endOfTrack"});this.endOfTrackTicks=d!==void 0?d.absoluteTime:void 0}}return e.prototype.addNote=function(t){var n=G.get(this),i=new oe.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(i,t),(0,lt.insert)(this.notes,i,"ticks"),this},e.prototype.addCC=function(t){var n=G.get(this),i=new ie.ControlChange({controllerType:t.number},n);return delete t.number,Object.assign(i,t),Array.isArray(this.controlChanges[i.number])||(this.controlChanges[i.number]=[]),(0,lt.insert)(this.controlChanges[i.number],i,"ticks"),this},e.prototype.addPitchBend=function(t){var n=G.get(this),i=new se.PitchBend({},n);return Object.assign(i,t),(0,lt.insert)(this.pitchBends,i,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var i=this.notes[n].time+this.notes[n].duration;t<i&&(t=i)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var i=this.notes[n].ticks+this.notes[n].durationTicks;t<i&&(t=i)}return t},enumerable:!1,configurable:!0}),e.prototype.fromJSON=function(t){var n=this;this.name=t.name,this.channel=t.channel,this.instrument=new pt.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var i in t.controlChanges)t.controlChanges[i]&&t.controlChanges[i].forEach(function(a){n.addCC({number:a.number,ticks:a.ticks,value:a.value})});t.notes.forEach(function(a){n.addNote({durationTicks:a.durationTicks,midi:a.midi,ticks:a.ticks,velocity:a.velocity})})},e.prototype.toJSON=function(){for(var t={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(t[n]=this.controlChanges[n].map(function(a){return a.toJSON()}));var i={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(a){return a.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(a){return a.toJSON()})};return this.endOfTrackTicks!==void 0&&(i.endOfTrackTicks=this.endOfTrackTicks),i},e}();j.Track=ce;var et={};function le(e){var t=[];return Ot(e,t),t}function Ot(e,t){for(var n=0;n<e.length;n++){var i=e[n];Array.isArray(i)?Ot(i,t):t.push(i)}}const ue=Object.freeze(Object.defineProperty({__proto__:null,flatten:le},Symbol.toStringTag,{value:"Module"})),he=jt(ue);var E=A&&A.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var i=0,a=t.length,s;i<a;i++)(s||!(i in t))&&(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(et,"__esModule",{value:!0});et.encode=void 0;var de=K,fe=Y,me=he;function pe(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function ye(e){return(0,me.flatten)(e.notes.map(function(t){return pe(t,e.channel)}))}function ge(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function ve(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(i){t.push(ge(i,e.channel))});return t}function be(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function xe(e){var t=[];return e.pitchBends.forEach(function(n){t.push(be(n,e.channel))}),t}function ke(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function we(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function Ie(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function Te(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Se(e){var t=fe.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function Ce(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function Fe(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:E([E(E(E(E([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(n){return Se(n)}),!0),e.header.meta.map(function(n){return Ce(n)}),!0),e.header.tempos.map(function(n){return Ie(n)}),!0),e.header.timeSignatures.map(function(n){return Te(n)}),!0)],e.tracks.map(function(n){return E(E(E([we(n.name),ke(n)],ye(n),!0),ve(n),!0),xe(n),!0)}),!0)};return t.tracks=t.tracks.map(function(n){n=n.sort(function(a,s){return a.absoluteTime-s.absoluteTime});var i=0;return n.forEach(function(a){a.deltaTime=a.absoluteTime-i,i=a.absoluteTime,delete a.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array((0,de.writeMidi)(t))}et.encode=Fe;(function(e){var t=A&&A.__awaiter||function(d,c,h,p){function y(m){return m instanceof h?m:new h(function(w){w(m)})}return new(h||(h=Promise))(function(m,w){function S(x){try{g(p.next(x))}catch(L){w(L)}}function M(x){try{g(p.throw(x))}catch(L){w(L)}}function g(x){x.done?m(x.value):y(x.value).then(S,M)}g((p=p.apply(d,c||[])).next())})},n=A&&A.__generator||function(d,c){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},p,y,m,w;return w={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function S(g){return function(x){return M([g,x])}}function M(g){if(p)throw new TypeError("Generator is already executing.");for(;h;)try{if(p=1,y&&(m=g[0]&2?y.return:g[0]?y.throw||((m=y.return)&&m.call(y),0):y.next)&&!(m=m.call(y,g[1])).done)return m;switch(y=0,m&&(g=[g[0]&2,m.value]),g[0]){case 0:case 1:m=g;break;case 4:return h.label++,{value:g[1],done:!1};case 5:h.label++,y=g[1],g=[0];continue;case 7:g=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(g[0]===6||g[0]===2)){h=0;continue}if(g[0]===3&&(!m||g[1]>m[0]&&g[1]<m[3])){h.label=g[1];break}if(g[0]===6&&h.label<m[1]){h.label=m[1],m=g;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(g);break}m[2]&&h.ops.pop(),h.trys.pop();continue}g=c.call(d,h)}catch(x){g=[6,x],y=0}finally{p=m=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var i=K,a=Y,s=j,r=et,u=function(){function d(c){var h=this,p=null;if(c){var y=c instanceof ArrayBuffer?new Uint8Array(c):c;p=(0,i.parseMidi)(y),p.tracks.forEach(function(m){var w=0;m.forEach(function(S){w+=S.deltaTime,S.absoluteTime=w})}),p.tracks=f(p.tracks)}this.header=new a.Header(p),this.tracks=[],c&&(this.tracks=p.tracks.map(function(m){return new s.Track(m,h.header)}),p.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return d.fromUrl=function(c){return t(this,void 0,void 0,function(){var h,p;return n(this,function(y){switch(y.label){case 0:return[4,fetch(c)];case 1:return h=y.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return p=y.sent(),[2,new d(p)];case 3:throw new Error("Could not load '".concat(c,"'"))}})})},Object.defineProperty(d.prototype,"name",{get:function(){return this.header.name},set:function(c){this.header.name=c},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){var c=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,c)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"durationTicks",{get:function(){var c=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,c)},enumerable:!1,configurable:!0}),d.prototype.addTrack=function(){var c=new s.Track(void 0,this.header);return this.tracks.push(c),c},d.prototype.toArray=function(){return(0,r.encode)(this)},d.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(c){return c.toJSON()})}},d.prototype.fromJSON=function(c){var h=this;this.header=new a.Header,this.header.fromJSON(c.header),this.tracks=c.tracks.map(function(p){var y=new s.Track(void 0,h.header);return y.fromJSON(p),y})},d.prototype.clone=function(){var c=new d;return c.fromJSON(this.toJSON()),c},d}();e.Midi=u;var l=j;Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var o=Y;Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return o.Header}});function f(d){for(var c=[],h=0;h<d.length;h++)for(var p=c.length,y=new Map,m=Array(16).fill(0),w=0,S=d[h];w<S.length;w++){var M=S[w],g=p,x=M.channel;if(x!==void 0){M.type==="programChange"&&(m[x]=M.programNumber);var L=m[x],ot="".concat(L," ").concat(x);y.has(ot)?g=y.get(ot):(g=p+y.size,y.set(ot,g))}c[g]||c.push([]),c[g].push(M)}return c}})(Mt);const Ue=""+new URL("processor-nTRAyC7c.js",import.meta.url).href;class Me{constructor(){v(this,"context");v(this,"workletNode",null);v(this,"isReady",!1);v(this,"reverbGainNode",null);this.context=new AudioContext}async init(){this.context.state==="suspended"&&await this.context.resume();try{await this.context.audioWorklet.addModule(Ue),this.workletNode=new AudioWorkletNode(this.context,"wavetable-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]});const t=this.context.createConvolver(),n=this.context.createGain(),i=2,a=this.context.sampleRate,s=a*i,r=this.context.createBuffer(2,s,a),u=r.getChannelData(0),l=r.getChannelData(1);for(let o=0;o<s;o++){const f=Math.pow(1-o/s,4);u[o]=(Math.random()*2-1)*f,l[o]=(Math.random()*2-1)*f}t.buffer=r,n.gain.value=.5,this.reverbGainNode=n,this.workletNode.connect(this.context.destination),this.workletNode.connect(t),t.connect(n),n.connect(this.context.destination),this.isReady=!0,console.log("Audio Engine Initialized")}catch(t){console.error("Failed to initialize audio worklet",t)}}setReverb(t){if(this.reverbGainNode){const n=this.context.currentTime;this.reverbGainNode.gain.cancelScheduledValues(n),this.reverbGainNode.gain.linearRampToValueAtTime(t?.5:0,n+.1)}}noteOn(t,n,i){!this.isReady||!this.workletNode||this.workletNode.port.postMessage({type:"NOTE_ON",payload:{note:t,velocity:n,channel:i}})}noteOff(t,n){!this.isReady||!this.workletNode||this.workletNode.port.postMessage({type:"NOTE_OFF",payload:{note:t,channel:n}})}setChannelWavetable(t,n){!this.isReady||!this.workletNode||this.workletNode.port.postMessage({type:"SET_CHANNEL_WAVETABLE",payload:{channel:t,wavetable:n}})}setChannelADSR(t,n){!this.isReady||!this.workletNode||this.workletNode.port.postMessage({type:"SET_CHANNEL_ADSR",payload:{channel:t,adsr:n}})}stopAll(){!this.isReady||!this.workletNode||this.workletNode.port.postMessage({type:"STOP_ALL"})}}class Ee{constructor(t,n){v(this,"container");v(this,"canvas");v(this,"ctx");v(this,"waveform");v(this,"onChange");this.container=document.getElementById(t),this.onChange=n,this.waveform=new Float32Array(32);for(let a=0;a<32;a++)this.waveform[a]=Math.sin(a/32*2*Math.PI);this.canvas=document.createElement("canvas"),this.canvas.width=320,this.canvas.height=150,this.container.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw new Error("Could not get canvas context");this.ctx=i,this.initEvents(),this.draw()}initEvents(){let t=!1;const n=i=>{const a=this.canvas.getBoundingClientRect(),s=i.clientX-a.left,r=i.clientY-a.top,u=Math.min(31,Math.max(0,Math.floor(s/10))),l=1-r/75;this.waveform[u]=Math.max(-1,Math.min(1,l)),this.draw(),this.onChange(this.waveform)};this.canvas.addEventListener("mousedown",i=>{t=!0,n(i)}),window.addEventListener("mousemove",i=>{if(!t)return;const a=this.canvas.getBoundingClientRect();i.clientX>=a.left&&i.clientX<=a.right&&i.clientY>=a.top&&i.clientY<=a.bottom&&n(i)}),window.addEventListener("mouseup",()=>{t=!1})}setWaveform(t){t.length===32&&(this.waveform.set(t),this.draw(),this.onChange(this.waveform))}getWaveform(){return this.waveform}draw(){this.ctx.fillStyle="#222",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="#444",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(0,75),this.ctx.lineTo(320,75),this.ctx.stroke(),this.ctx.fillStyle="#4a90e2";for(let t=0;t<32;t++){const i=this.waveform[t]*-75;this.ctx.fillRect(t*10+1,75,8,i)}}}class Pe{constructor(t,n){v(this,"container");v(this,"canvas");v(this,"ctx");v(this,"values");v(this,"onChange");v(this,"timeScale",50);v(this,"msgScale",100);v(this,"draggingPoint",null);this.container=document.getElementById(t),this.onChange=n,this.values={a:.1,d:.2,s:.5,r:.5},this.canvas=document.createElement("canvas"),this.canvas.width=400,this.canvas.height=150,this.container.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw new Error("Could not get canvas context");this.ctx=i,this.initEvents(),this.draw()}getPoints(){const{a:t,d:n,s:i,r:a}=this.values,u=this.canvas.height-20,l=u-this.msgScale,o={x:0,y:u},f={x:t*this.timeScale,y:l},d=u-i*this.msgScale,c={x:(t+n)*this.timeScale,y:d},h=1,p={x:(t+n+h)*this.timeScale,y:d},y={x:(t+n+h+a)*this.timeScale,y:u};return[o,f,c,p,y]}updateFromPoints(t,n,i){const r=this.canvas.height-20,u=1;let l=t.x/this.timeScale;l=Math.max(.01,l);let o=n.x/this.timeScale-l;o=Math.max(.01,o);let f=(r-n.y)/this.msgScale;f=Math.max(0,Math.min(1,f));const d=l+o+u;let c=i.x/this.timeScale-d;c=Math.max(.01,c),this.values={a:l,d:o,s:f,r:c},this.onChange(this.values),this.draw()}initEvents(){this.canvas.addEventListener("mousedown",t=>{const n=this.canvas.getBoundingClientRect(),i=t.clientX-n.left,a=t.clientY-n.top,s=this.getPoints(),r=10;this.dist(i,a,s[1].x,s[1].y)<r?this.draggingPoint=1:this.dist(i,a,s[2].x,s[2].y)<r?this.draggingPoint=2:this.dist(i,a,s[4].x,s[4].y)<r&&(this.draggingPoint=4)}),window.addEventListener("mousemove",t=>{if(this.draggingPoint===null)return;const n=this.canvas.getBoundingClientRect(),i=Math.max(0,t.clientX-n.left),a=Math.max(0,t.clientY-n.top),s=this.getPoints();let r=s[1];s[2],s[4],this.draggingPoint===1&&(r={x:i,y:r.y});const u=1,l=this.msgScale,o=this.timeScale,f=this.canvas.height-20;if(this.draggingPoint===1){let d=i/o;this.values.a=Math.max(.01,d)}else if(this.draggingPoint===2){let d=i/o-this.values.a;this.values.d=Math.max(.01,d);let c=(f-a)/l;this.values.s=Math.max(0,Math.min(1,c))}else if(this.draggingPoint===4){let d=this.values.a+this.values.d+u,c=i/o-d;this.values.r=Math.max(.01,c)}this.onChange(this.values),this.draw()}),window.addEventListener("mouseup",()=>{this.draggingPoint=null})}dist(t,n,i,a){return Math.sqrt(Math.pow(i-t,2)+Math.pow(a-n,2))}setValues(t){this.values={...t},this.draw()}draw(){this.ctx.fillStyle="#1e1e1e",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const t=this.getPoints();this.ctx.strokeStyle="#646cff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke(),this.ctx.fillStyle="#fff";const n=i=>{this.ctx.beginPath(),this.ctx.arc(t[i].x,t[i].y,5,0,Math.PI*2),this.ctx.fill()};n(1),n(2),n(4),this.ctx.strokeStyle="#888",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t[2].x,t[2].y),this.ctx.lineTo(t[3].x,t[3].y),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle="#aaa",this.ctx.font="10px monospace",this.ctx.fillText(`A: ${this.values.a.toFixed(2)}s`,10,10),this.ctx.fillText(`D: ${this.values.d.toFixed(2)}s`,10,22),this.ctx.fillText(`S: ${this.values.s.toFixed(2)}`,10,34),this.ctx.fillText(`R: ${this.values.r.toFixed(2)}s`,10,46)}}class Oe{constructor(t){v(this,"canvas");v(this,"ctx");v(this,"midi",null);v(this,"pixelsPerSecond",50);v(this,"noteHeight",4);v(this,"lastDrawTime",0);v(this,"activeNotesCache");v(this,"colors",["#FF5733","#33FF57","#3357FF","#FF33A1","#33FFF5","#F5FF33","#FF8C33","#8C33FF","#FF3333","#33FF33","#3333FF","#FFFF33","#33FFFF","#FF33FF","#CCCCCC","#FFFFFF"]);const n=document.getElementById(t);this.canvas=document.createElement("canvas"),this.canvas.width=n.clientWidth,this.canvas.height=128*this.noteHeight,this.canvas.style.background="#111",this.canvas.style.width="100%",n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),new ResizeObserver(()=>{this.canvas.width=n.clientWidth,this.draw(this.lastDrawTime,this.activeNotesCache)}).observe(n)}setMidi(t){this.midi=t,this.draw(0)}setNoteHeight(t){this.noteHeight=Math.max(4,Math.min(50,t)),this.canvas.height=128*this.noteHeight,this.draw(this.lastDrawTime,this.activeNotesCache)}zoomIn(){this.setNoteHeight(this.noteHeight+4)}zoomOut(){this.setNoteHeight(this.noteHeight-4)}draw(t,n){if(this.lastDrawTime=t,n?this.activeNotesCache=n:n===void 0&&this.activeNotesCache&&(n=this.activeNotesCache),!this.midi){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#444",this.ctx.textAlign="center",this.ctx.font="16px sans-serif",this.ctx.fillText("No MIDI Loaded",this.canvas.width/2,this.canvas.height/2);return}const i=this.canvas.width,a=this.canvas.height,s=60;this.ctx.clearRect(0,0,i,a),this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(s,0,i-s,a),this.ctx.clip();const r=i-s,u=t*this.pixelsPerSecond-r*.2;this.midi.tracks.forEach((o,f)=>{const d=this.colors[f%this.colors.length]||"#888";this.ctx.fillStyle=d,o.notes.forEach(c=>{const h=c.time*this.pixelsPerSecond-u+s,p=c.duration*this.pixelsPerSecond;if(h+p<s||h>i)return;const y=(127-c.midi)*this.noteHeight;this.ctx.fillRect(h,y,p,this.noteHeight-1)})});const l=s+r*.2;this.ctx.strokeStyle="#FFF",this.ctx.beginPath(),this.ctx.moveTo(l,0),this.ctx.lineTo(l,a),this.ctx.stroke(),this.ctx.restore(),this.ctx.fillStyle="#222",this.ctx.fillRect(0,0,s,a);for(let o=0;o<=127;o++){const f=(127-o)*this.noteHeight,d=o%12,c=[1,3,6,8,10].includes(d);let h=c?"#444":"#EEE",p=c?s*.6:s;const y=n==null?void 0:n.get(o);if(y!==void 0&&y>0&&(h=`rgba(255, 100, 100, ${.4+y*.6})`,p=s),this.ctx.fillStyle=h,c?this.ctx.fillRect(0,f,p,this.noteHeight-1):this.ctx.fillRect(0,f,p,this.noteHeight-1),d===0&&o%12===0){this.ctx.fillStyle="#888",this.ctx.font="10px monospace",this.ctx.textAlign="right";const m=`C${o/12-1}`;this.ctx.fillText(m,s-2,f+this.noteHeight*.7)}}this.ctx.fillStyle="#FFF",this.ctx.font="12px sans-serif",this.ctx.textAlign="left",this.ctx.fillText(t.toFixed(2)+"s",l+5,10)}}let k=null,O=!1,H=0,Ne=.1,X=0,Nt,V=0,R=0;const ht=new Set(Array.from({length:16},(e,t)=>t));let F=0;const U=[];for(let e=0;e<16;e++)U.push(new Map);const Be=document.querySelector("#app");Be.innerHTML=`
  <div class="synth-container">
    <h1>ゆのみシンセ</h1>
    
    <div class="card control-panel">
       <button id="btn-load" class="file-upload-btn">Load MIDI File</button>
       <input type="file" id="file-input" accept=".mid,.midi" />
       
       <button id="btn-play">Play</button>
       <button id="btn-stop">Stop</button>
       
       <div id="file-info" style="margin: 10px 0; font-size: 14px; color: #acf;"></div>

       <input type="range" id="seek-bar" min="0" max="100" value="0" style="width: 300px;" disabled>
       <span id="time-display">0:00 / 0:00</span>

       <label style="margin-left: 20px;">
         <input type="checkbox" id="reverb-toggle" checked> Reverb
       </label>
       
       <div style="font-family:monospace; margin-left: 20px;">
         BPM: <span id="bpm-display">--</span>
       </div>
    </div>
    
    <div class="card">
      <h3>Channels</h3>
      <div class="channel-list" id="channel-list"></div>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>Piano Roll</h3>
            <div>
                <button id="pr-zoom-out" style="padding: 2px 8px;">-</button>
                <button id="pr-zoom-in" style="padding: 2px 8px;">+</button>
            </div>
        </div>
        <div id="piano-roll" style="height: 400px; width: 100%; position: relative; overflow-y: auto;"></div>
    </div>

    <div class="visualizers">
       <div class="editor-section">
           <h3>Wavetable (CH <span id="wt-ch-label">1</span>)</h3>
           <div class="preset-buttons">
              <button id="wt-rect">Rect</button>
              <button id="wt-tri">Tri</button>
              <button id="wt-saw">Saw</button>
              <button id="wt-rand">Rnd</button>
           </div>
           <div id="wt-editor"></div>
       </div>
       
       <div class="editor-section">
           <h3>ADSR (CH <span id="adsr-ch-label">1</span>)</h3>
           <div class="preset-buttons">
              <button id="adsr-pluck">Pluck</button>
              <button id="adsr-pad">Pad</button>
              <button id="adsr-lead">Lead</button>
           </div>
           <div id="adsr-editor"></div>
       </div>
    </div>
  </div>
`;const _e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Ae(e){const t=_e[e%12],n=Math.floor(e/12)-1;return`${t}${n}`}const I=new Me;let B;B=new Ee("wt-editor",e=>{ft(e),B.draw(),I.setChannelWavetable(F,e),D[F].wavetable.set(e)});const nt=new Pe("adsr-editor",e=>{I.setChannelADSR(F,e),D[F].adsr={...e}}),rt=new Oe("piano-roll");var yt;(yt=document.getElementById("pr-zoom-in"))==null||yt.addEventListener("click",()=>rt.zoomIn());var gt;(gt=document.getElementById("pr-zoom-out"))==null||gt.addEventListener("click",()=>rt.zoomOut());const D=[];for(let e=0;e<16;e++){const t=new Float32Array(32);for(let n=0;n<32;n++){const i=n/32;e<4?t[n]=i<.5?1:-1:e<8?t[n]=i<.5?4*i-1:1-4*(i-.5):t[n]=Math.sin(i*2*Math.PI)}ft(t),D.push({wavetable:t,adsr:{a:.1,d:.1,s:.5,r:.2}})}function Bt(){document.getElementById("wt-ch-label").innerText=(F+1).toString(),document.getElementById("adsr-ch-label").innerText=(F+1).toString(),B.setWaveform(D[F].wavetable),nt.setValues(D[F].adsr)}const it=document.getElementById("channel-list");it.style.display="grid";it.style.gridTemplateColumns="repeat(4, 1fr)";it.style.gap="10px";const _t=[];for(let e=0;e<16;e++){const t=document.createElement("div");t.className="channel-item",t.style.padding="5px",t.style.border="1px solid #555",t.style.borderRadius="4px",t.style.display="flex",t.style.flexDirection="column",t.style.background="#222";const n=document.createElement("div");n.style.display="flex",n.style.justifyContent="space-between",n.style.marginBottom="5px";const i=document.createElement("span");i.innerText=`CH ${e+1}`;const a=document.createElement("div"),s=document.createElement("input");s.type="radio",s.name="edit-channel",s.checked=e===0,e===9&&(s.style.visibility="hidden"),s.onchange=()=>{s.checked&&(F=e,Bt(),z())};const r=document.createElement("input");r.type="checkbox",r.checked=!0,r.onchange=()=>{r.checked?ht.add(e):ht.delete(e)},a.appendChild(document.createTextNode("Edit ")),a.appendChild(s),a.appendChild(document.createTextNode(" Play ")),a.appendChild(r),n.appendChild(i),n.appendChild(a);const u=document.createElement("div");u.className="note-display",u.style.height="20px",u.style.fontSize="12px",u.style.color="#8f8",u.innerText="-",t.appendChild(n),t.appendChild(u),it.appendChild(t);const l=()=>{if(U[e].size===0)u.innerText="-";else{const o=Array.from(U[e].keys()).sort((f,d)=>f-d);u.innerText=o.map(f=>Ae(f)).join(" ")}F===e?(t.style.borderColor="#646cff",t.style.background="#333"):(t.style.borderColor="#555",t.style.background="#222")};_t.push(l)}function z(){_t.forEach(e=>e())}const C=document.getElementById("seek-bar"),Re=document.getElementById("time-display");C.addEventListener("input",()=>{if(!k)return;const e=parseInt(C.value)/100*k.duration;O&&at(),W(e)});C.addEventListener("change",()=>{if(!k)return;const e=parseInt(C.value)/100*k.duration;H=I.context.currentTime-e,X=e,I.stopAll(),U.forEach(t=>t.clear()),z(),O||(R=e)});const At=document.getElementById("file-input");var vt;(vt=document.getElementById("btn-load"))==null||vt.addEventListener("click",()=>At.click());At.addEventListener("change",async e=>{var s;const t=(s=e.target.files)==null?void 0:s[0];if(!t)return;const n=await t.arrayBuffer();k=new Mt.Midi(n),rt.setMidi(k),V=k.duration,C.disabled=!1,C.value="0",W(0);const i=k.header.tempos.length>0?k.header.tempos[0].bpm:120;document.getElementById("bpm-display").innerText=Math.round(i).toString();const a=k.name||(k.tracks.length>0?k.tracks[0].name:"")||"Unknown Title";document.getElementById("file-info").innerText=`File: ${t.name} | Title: ${a}`,console.log("MIDI Loaded",k)});function W(e){const t=Math.floor(e/60),n=Math.floor(e%60).toString().padStart(2,"0"),i=Math.floor(V/60),a=Math.floor(V%60).toString().padStart(2,"0");Re.innerText=`${t}:${n} / ${i}:${a}`}async function De(){if(!k){alert("Please load a MIDI file first.");return}if(await I.init(),D.forEach((e,t)=>{I.setChannelWavetable(t,e.wavetable),I.setChannelADSR(t,e.adsr)}),O){at(),R=I.context.currentTime-H;return}O=!0,document.getElementById("btn-play").innerText="Pause",H=I.context.currentTime-R,X=R,I.stopAll(),U.forEach(e=>e.clear()),Rt()}function at(){O=!1,document.getElementById("btn-play").innerText="Play",I.stopAll(),cancelAnimationFrame(Nt),U.forEach(e=>e.clear()),z()}function Rt(){if(!O||!k)return;const e=I.context.currentTime,t=e-H;if(t>V){at(),R=0,C.value="0",W(0);return}const n=t/V*100;Math.abs(parseFloat(C.value)-n)>.5&&document.activeElement!==C&&(C.value=n.toString(),W(t));const i=t+Ne;k.tracks.forEach(s=>{s.notes.forEach(r=>{const u=s.channel??0;if(ht.has(u)&&r.time>=X&&r.time<i){const o=H+r.time-e,f=Math.max(0,o*1e3),d=r.duration*1e3;setTimeout(()=>{O&&(I.noteOn(r.midi,r.velocity*127,u),U[u].set(r.midi,r.velocity))},f),setTimeout(()=>{O&&(I.noteOff(r.midi,u),U[u].delete(r.midi))},f+d)}})}),X=i,z();const a=new Map;U.forEach(s=>{s.forEach((r,u)=>{const l=a.get(u)||0;a.set(u,Math.max(l,r))})}),rt.draw(t,a),Nt=requestAnimationFrame(Rt)}var bt;(bt=document.getElementById("reverb-toggle"))==null||bt.addEventListener("change",e=>{I.setReverb(e.target.checked)});var xt;(xt=document.getElementById("btn-play"))==null||xt.addEventListener("click",De);var kt;(kt=document.getElementById("btn-stop"))==null||kt.addEventListener("click",()=>{at(),R=0,C.value="0",W(0)});function ft(e){let t=0,n=0;for(let r=0;r<e.length;r++){const u=e[r],l=Math.abs(u);l>t&&(t=l),n+=u*u}if(t===0)return e;const i=Math.sqrt(n/e.length);if(i===0)return e;let s=.6/i;s*t>1&&(s=1/t);for(let r=0;r<e.length;r++)e[r]*=s;return e}const ut=32;function st(e){const t=new Float32Array(ut);for(let n=0;n<ut;n++){const i=n/ut;let a=0;e==="rect"?a=i<.5?1:-1:e==="tri"?a=i<.5?4*i-1:1-4*(i-.5):e==="saw"?a=2*i-1:e==="rand"&&(a=Math.random()*2-1),t[n]=a}return ft(t)}var wt;(wt=document.getElementById("wt-rect"))==null||wt.addEventListener("click",()=>B.setWaveform(st("rect")));var It;(It=document.getElementById("wt-tri"))==null||It.addEventListener("click",()=>B.setWaveform(st("tri")));var Tt;(Tt=document.getElementById("wt-saw"))==null||Tt.addEventListener("click",()=>B.setWaveform(st("saw")));var St;(St=document.getElementById("wt-rand"))==null||St.addEventListener("click",()=>B.setWaveform(st("rand")));var Ct;(Ct=document.getElementById("adsr-pluck"))==null||Ct.addEventListener("click",()=>nt.setValues({a:.01,d:.1,s:0,r:.1}));var Ft;(Ft=document.getElementById("adsr-pad"))==null||Ft.addEventListener("click",()=>nt.setValues({a:1,d:1,s:.8,r:2}));var Ut;(Ut=document.getElementById("adsr-lead"))==null||Ut.addEventListener("click",()=>nt.setValues({a:.05,d:.2,s:.5,r:.3}));z();Bt();
